/*
 * (c) 2024 mingyu
 * 可摺疊提示詞群組的樣式
 */

/* 1. 群組外層容器 (<details>)
------------------------------------------------------------ */
.mingyu-prompt-group {
    list-style-type: none !important; /* 移除原生列表樣式 */
    margin-bottom: 2px; /* 群組間加點間距 */
}

/* 2. 可點擊的標題區域 (<summary>)
------------------------------------------------------------ */
.mingyu-prompt-group > summary {
    display: flex; /* 使用 Flexbox 來對齊箭頭和標題文字 */
    align-items: center; /* 垂直置中 */
    position: relative;
    cursor: pointer;
    list-style: none; /* 移除原生箭頭 */
    user-select: none; /* 防止點擊時選取文字 */
}

/* 移除 Webkit/Blink 和標準瀏覽器的原生箭頭 */
.mingyu-prompt-group > summary::-webkit-details-marker,
.mingyu-prompt-group > summary::marker {
    display: none;
}

/* 3. 自訂的箭頭圖示
------------------------------------------------------------ */
.mingyu-prompt-group > summary::before {
    content: '▶';
    font-size: 0.75em;
    color: #aaa;
    margin-right: 8px; /* 箭頭和文字之間的距離 */
    transition: transform 0.2s ease-in-out;
    display: inline-block; /* 確保 transform 生效 */
    flex-shrink: 0; /* 防止箭頭被壓縮 */
}

/* 當群組展開時，旋轉箭頭 */
.mingyu-prompt-group[open] > summary::before {
    transform: rotate(90deg);
}

/* 4. 作為標題的那個 LI 項目
------------------------------------------------------------ */
.mingyu-prompt-group > summary > li.completion_prompt_manager_prompt {
    /* 讓 LI 填滿 summary 的剩餘空間 */
    flex: 1;
    display: inline-flex;
    align-items: center;
    /* 移除 JS 中加入的 padding-left，改由箭頭的 margin-right 控制間距 */
    padding-left: 0 !important; 
}

/* 5. 標題內的星號圖示隱藏
------------------------------------------------------------ */
.mingyu-prompt-group li.is-group-header .fa-asterisk {
    display: none !important; /* 強制隱藏作為標題的提示詞的星號 */
}

/* 6. 群組內容區域 (<div>)
------------------------------------------------------------ */
.mingyu-prompt-group-content {
    padding-left: 20px;
    border-left: 1px solid #444;
    margin-left: 4px; /* 邊線和箭頭視覺上對齊 */
    margin-top: 5px; /* 內容和標題之間加點間距 */
}

/* 7. 拖曳狀態的視覺回饋 (改進)
------------------------------------------------------------ */
li.completion_prompt_manager_prompt[draggable="true"] {
    cursor: move;
}

/* 拖曳中的項目半透明 */
li.completion_prompt_manager_prompt.dragging {
    opacity: 0.4;
    background-color: rgba(74, 158, 255, 0.1);
}

/* 拖曳中的整個群組有邊框提示 */
.mingyu-prompt-group.dragging-group {
    outline: 2px dashed #4a9eff;
    outline-offset: 2px;
    border-radius: 4px;
}

/* 8. 拖曳目標區域的視覺回饋 (新增)
------------------------------------------------------------ */
li.completion_prompt_manager_prompt[draggable="true"]:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

/* 10. 空群組的提示 (保持)
------------------------------------------------------------ */
.mingyu-prompt-group-content:empty::after {
    content: '(空群組)';
    color: #666;
    font-style: italic;
    font-size: 0.9em;
    padding: 5px 0;
    display: block;
}

/* 11. Hover 效果改進 (保持)
------------------------------------------------------------ */
.mingyu-prompt-group > summary:hover {
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
}

.mingyu-prompt-group > summary:hover::before {
    color: #fff; /* 懸停時箭頭變亮 */
}

/* 12. 焦點狀態 (保持)
------------------------------------------------------------ */
.mingyu-prompt-group > summary:focus {
    outline: 2px solid #4a9eff;
    outline-offset: 2px;
    border-radius: 4px;
}

/* 13. 過渡動畫改進 (保持)
------------------------------------------------------------ */
.mingyu-prompt-group-content {
    animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 14. 深色主題適配 (保持)
------------------------------------------------------------ */
@media (prefers-color-scheme: light) {
    .mingyu-prompt-group > summary::before {
        color: #666;
    }
    
    .mingyu-prompt-group-content {
        border-left-color: #ddd;
    }
    
    .mingyu-prompt-group > summary:hover {
        background-color: rgba(0, 0, 0, 0.05);
    }
    
    li.completion_prompt_manager_prompt.dragging {
        background-color: rgba(74, 158, 255, 0.2);
    }
}

/* 15. Header 佈局優化 + 全部展開/收合按鈕樣式
------------------------------------------------------------ */
.completion_prompt_manager_header {
    display: flex !important;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.mingyu-collapse-controls {
    display: flex;
    gap: 6px;
    align-items: center;
    margin-left: auto; /* 推到最右邊 */
}

.mingyu-settings-toggle,
.mingyu-expand-all,
.mingyu-collapse-all {
    padding: 4px 8px;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s, transform 0.1s;
    background: transparent;
    border: none;
    font-size: 16px;
    line-height: 1;
}

.mingyu-settings-toggle:hover,
.mingyu-expand-all:hover,
.mingyu-collapse-all:hover {
    opacity: 1;
}

.mingyu-settings-toggle.active {
    opacity: 1;
    background-color: rgba(74, 158, 255, 0.2);
    border-radius: 4px;
}

.mingyu-settings-toggle:active,
.mingyu-expand-all:active,
.mingyu-collapse-all:active {
    transform: scale(0.95);
}

/* 16. 設定面板樣式
------------------------------------------------------------ */
#prompt-folding-settings {
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.2);
}

#prompt-folding-settings h3 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.1em;
}

#prompt-folding-settings .notes {
    display: block;
    margin-bottom: 8px;
    color: #aaa;
}

#prompt-folding-dividers {
    width: 100%;
    font-family: 'Courier New', monospace;
}

/* 說明圖示樣式 */
.mingyu-help-icon {
    position: absolute;
    top: 0;
    right: 0;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: var(--SmartThemeBlurTintColor, rgba(255, 255, 255, 0.1));
    color: var(--SmartThemeBodyColor, #fff);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    cursor: help;
    transition: all 0.2s ease;
    border: 1px solid var(--SmartThemeBorderColor, rgba(255, 255, 255, 0.2));
}

.mingyu-help-icon:hover {
    background-color: var(--SmartThemeQuotColor, rgba(255, 255, 255, 0.2));
    transform: scale(1.1);
}